<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Food View - Food Palace</title>
    <!-- AR.js Libraries -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        .ar-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        .instructions-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            text-align: center;
            z-index: 1000;
        }
        
        .instructions-overlay h2 {
            margin-bottom: 10px;
            color: #4ecdc4;
        }
        
        .instructions-overlay p {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff6b6b;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 1001;
        }
        
        .controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 15px;
            z-index: 1000;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        #food-selector {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 10px;
            z-index: 1000;
        }
        
        .dish-option {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Instructions Overlay -->
    <div class="instructions-overlay" id="instructions">
        <h2>üì± AR Food Viewer</h2>
        <p>1. Allow camera access when prompted</p>
        <p>2. Point camera at the Hiro marker</p>
        <p>3. Food will appear in 3D!</p>
        <p><strong>Need the marker? <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" style="color: #4ecdc4;" target="_blank">Download Here</a></strong></p>
        <button class="close-btn" onclick="hideInstructions()">‚úï</button>
    </div>

    <!-- AR Scene -->
    <div class="ar-container">
        <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
            
            <!-- AR Marker -->
            <a-marker preset="hiro" id="marker">
                
                <!-- Dish 1: Biryani -->
                <a-entity id="biryani" visible="false">
                    <!-- Plate -->
                    <a-cylinder position="0 0.1 0" radius="0.5" height="0.05" color="#F5F5DC"></a-cylinder>
                    
                    <!-- Rice Base -->
                    <a-cylinder position="0 0.15 0" radius="0.45" height="0.2" color="#FFD700"></a-cylinder>
                    
                    <!-- Chicken Piece 1 -->
                    <a-box position="-0.2 0.25 0.1" width="0.15" height="0.1" depth="0.1" color="#8B4513"></a-box>
                    
                    <!-- Chicken Piece 2 -->
                    <a-box position="0.1 0.25 -0.15" width="0.15" height="0.1" depth="0.1" color="#8B4513" rotation="0 45 0"></a-box>
                    
                    <!-- Garnish -->
                    <a-sphere position="0.2 0.25 0.2" radius="0.03" color="#FF0000"></a-sphere>
                    <a-sphere position="-0.1 0.25 -0.2" radius="0.03" color="#00FF00"></a-sphere>
                    
                    <!-- Label -->
                    <a-text value="Chicken Biryani" position="0 0.5 0" color="#FFFFFF" align="center" width="3"></a-text>
                </a-entity>
                
                <!-- Dish 2: Kebab -->
                <a-entity id="kebab" visible="false">
                    <!-- Skewer -->
                    <a-cylinder position="0 0.1 0" radius="0.02" height="1" color="#8B4513" rotation="0 0 90"></a-cylinder>
                    
                    <!-- Kebab 1 -->
                    <a-cylinder position="-0.3 0.1 0" radius="0.08" height="0.15" color="#A0522D" rotation="0 0 90"></a-cylinder>
                    
                    <!-- Kebab 2 -->
                    <a-cylinder position="0 0.1 0" radius="0.08" height="0.15" color="#A0522D" rotation="0 0 90"></a-cylinder>
                    
                    <!-- Kebab 3 -->
                    <a-cylinder position="0.3 0.1 0" radius="0.08" height="0.15" color="#A0522D" rotation="0 0 90"></a-cylinder>
                    
                    <!-- Label -->
                    <a-text value="Seekh Kebab" position="0 0.5 0" color="#FFFFFF" align="center" width="3"></a-text>
                </a-entity>
                
                <!-- Dish 3: Butter Chicken -->
                <a-entity id="butter-chicken" visible="false">
                    <!-- Bowl -->
                    <a-cylinder position="0 0.1 0" radius="0.4" height="0.2" color="#FFF8DC" open-ended="true"></a-cylinder>
                    
                    <!-- Curry -->
                    <a-cylinder position="0 0.15 0" radius="0.35" height="0.15" color="#FF4500"></a-cylinder>
                    
                    <!-- Chicken Pieces -->
                    <a-box position="-0.2 0.15 0.1" width="0.1" height="0.05" depth="0.1" color="#8B4513" rotation="0 30 0"></a-box>
                    <a-box position="0.15 0.15 -0.15" width="0.1" height="0.05" depth="0.1" color="#8B4513" rotation="0 -30 0"></a-box>
                    
                    <!-- Cream -->
                    <a-sphere position="0.2 0.2 0.2" radius="0.05" color="#FFFFFF"></a-sphere>
                    
                    <!-- Label -->
                    <a-text value="Butter Chicken" position="0 0.5 0" color="#FFFFFF" align="center" width="3"></a-text>
                </a-entity>
                
            </a-marker>
            
            <!-- Camera -->
            <a-entity camera></a-entity>
        </a-scene>
    </div>

    <!-- Controls -->
    <div class="controls">
        <button class="control-btn" onclick="changeDish('biryani')">
            üçö Biryani
        </button>
        <button class="control-btn" onclick="changeDish('kebab')">
            üç¢ Kebab
        </button>
        <button class="control-btn" onclick="changeDish('butter-chicken')">
            üçó Butter Chicken
        </button>
        <button class="control-btn" onclick="location.reload()">
            üîÑ Reset
        </button>
    </div>

    <!-- JavaScript -->
    <script>
        // --- NAYA CODE: SAFE INITIALIZATION ---
        let selectedDish = localStorage.getItem('selectedDish') || 'biryani';
        let dishElementsLoaded = false; // Flag to track if 3D elements are ready
        
        // Function to change dish - NOW SAFE
        function changeDish(dishName) {
            // Check if elements are available before trying to change
            if (!dishElementsLoaded) {
                console.warn('3D Dish elements are not loaded yet. Please try again in a moment.');
                return; // Exit the function if not ready
            }
            
            // All dish IDs to hide
            const dishIds = ['biryani', 'kebab', 'butter-chicken'];
            
            // Hide all dishes first
            dishIds.forEach(id => {
                const dishElement = document.getElementById(id);
                if (dishElement) {
                    dishElement.setAttribute('visible', 'false');
                } else {
                    console.error(`Dish element with ID '${id}' not found!`);
                }
            });
            
            // Show the selected dish
            const selectedElement = document.getElementById(dishName);
            if (selectedElement) {
                selectedElement.setAttribute('visible', 'true');
                console.log(`Now showing: ${dishName}`);
                selectedDish = dishName;
            } else {
                console.error(`Selected dish '${dishName}' not found!`);
            }
        }
        
        // Function to check if all dish elements exist in the DOM
        function checkIfDishElementsExist() {
            const requiredIds = ['biryani', 'kebab', 'butter-chicken', 'marker'];
            const allExist = requiredIds.every(id => document.getElementById(id) !== null);
            
            if (allExist) {
                dishElementsLoaded = true;
                console.log('All 3D dish elements are now loaded and ready.');
                // Now it's safe to show the initial dish
                changeDish(selectedDish);
            } else {
                // If not ready yet, check again in 100ms
                setTimeout(checkIfDishElementsExist, 100);
            }
        }
        
        // --- EVENT LISTENERS ---
        // Wait for the entire page (including A-Frame elements) to load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded. Checking for 3D elements...');
            checkIfDishElementsExist(); // Start checking for 3D elements
        });
        
        // Listen for when the AR marker is found (optional visual feedback)
        document.addEventListener('DOMContentLoaded', function() {
            const marker = document.getElementById('marker');
            if (marker) {
                marker.addEventListener('markerFound', () => {
                    console.log('Marker detected! If dish is not visible, try pressing a dish button.');
                });
            }
        });
        
        // Hide instructions after 10 seconds
        setTimeout(() => {
            const instructions = document.getElementById('instructions');
            if (instructions) instructions.style.display = 'none';
        }, 10000);
        
        // Fullscreen toggle and key controls remain the same
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }
        document.addEventListener('keydown', function(e) {
            if (e.key === 'i' || e.key === 'I') {
                const instructions = document.getElementById('instructions');
                if (instructions) {
                    instructions.style.display = instructions.style.display === 'none' ? 'block' : 'none';
                }
            }
        });
    </script>
</body>
</html>